import Table from "react-bootstrap/Table";
import Tabs from "react-bootstrap/Tabs";
import Tab from "react-bootstrap/Tab";
import Row from 'react-bootstrap/Row';
import Col from 'react-bootstrap/Col';

import { useRef } from "react";


function VulnerabilityDetails({advisory, dependencies}) {
    let i = useRef(0);
    function getId() {return i++}

    return (
        <Tabs>
        {advisory.vulnerabilities.filter((vuln) => {
            for(let i = 0; i < dependencies.length; i++) {
                if(vuln.productStatus.has(dependencies[i])) return true;
            }
            return false;
        }).map((vulnerability) => {
            return <Tab eventKey={getId()} title={"SNTL-123-4567"}>
                <br></br>
                <Row>
                    <Col lg="1">{vulnerability.cwe}</Col>
                    <Col lg="11">{vulnerability.description}</Col>
                </Row>
                <br></br>
                {dependencies.map((dep) => {
                    return <div> 
                        {(advisory.getProductInformation(dep)).map((info) => {
                            return <div>
                                <h5>{info.fullName}</h5>
                                <Table striped bordered>
                                    <tbody>
                                        <tr>
                                            <td>Version</td>
                                            <td>{info.version}</td>
                                        </tr>
                                        <tr>
                                            <td>Identifier</td>
                                            <td>{info.identifier}</td>
                                        </tr>
                                        <tr>
                                            <td>Status</td>
                                            <td>{info.status}</td>
                                        </tr>
                                        <tr>
                                            <td>CVSS V3</td>
                                            <td>{info.cvss}</td>
                                        </tr>
                                        <tr>
                                            <td>Remediations</td>
                                            <td style={{"w": "unset"}}>{info.remediations.join("\n\n")}</td>
                                        </tr>
                                    </tbody>
                                </Table>
                                <br/>
                            </div>
                        })}
                    </div>
                })}
            </Tab>
        })}
        </Tabs>
    )
}
export default VulnerabilityDetails;

/*
                        <Tabs>
                            <Tab eventKey="VulnerabilityDetails" title="Vulnerability details">
                                <br></br>
                                <h2>{vulnerability.advisory.title}</h2>
                                <hr></hr>
                                <h3>{vulnerability.advisory.description}</h3>
                                <br />
                                {dependencies !== []
                                    ? <VulnerabilityDetails advisory={vulnerability.advisory} dependencies={dependencies} />
                                    : <h5>Cannot show because of missing dependency information.</h5>}

                            </Tab>
                            <Tab eventKey="TransactionData" title="Transaction data">
                                <div><pre>{JSON.stringify(vulnerability.tx, null, 2)}</pre></div>
                            </Tab>
                            <Tab eventKey="BlockData" title="Block data">
                                <div><pre>{JSON.stringify(vulnerability.block, null, 2)}</pre></div>
                            </Tab>
                            <Tab eventKey="AdvisoryData" title="Advisory data">
                                <div><pre>{vulnerability.advisory.toString()}</pre></div>
                            </Tab>
                        </Tabs>
                        */